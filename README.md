<h1 align="center">FunPay Cortex</h1>
<h4 align="center">Простой и эффективный бот для автоматизации FunPay</h4>

<!-- Опционально: Добавьте сюда ссылку на ваш Telegram чат -->
<h2 align="center">Перед началом настоятельно рекомендую залететь в наш <a href="https://t.me/FunPayCortex">Telegram чат (клик)</a>. Тут и поможем чем сможем и посидеть можно.</h2>

**Содержание**

*   [Возможности](#robot-возможности)
    *   [FunPay](#shopping_cart-funpay)
    *   [Уведомления и ПУ в Telegram](#left_speech_bubble-уведомления-и-пу-в-telegram)
    *   [Дополнительные возможности](#gear-дополнительные-возможности)
*   [Преимущества](#1st_place_medal-преимущества)
    *   [Для пользователей](#grinning-для-пользователей)
    *   [Для разработчиков](#computer-для-разработчиков)
*   [Плагины](#electric_plug-плагины)
*   [Установка](#arrow_down-установка)
    *   [Windows](#large_blue_diamond-windows)
    *   [Linux (Ubuntu)](#hotsprings-linux-ubuntu)
    *   [Android (Termux)](#iphone-android-termux)
*   [Установка плагинов](#electric_plug-установка-плагинов-1) <!-- Added -1 because anchor already exists -->
*   [Мне нужна помощь](#question-мне-нужна-помощь)
*   [Star it](#star-star-it)

## :robot: Возможности
### :shopping_cart: FunPay

*   Автовыдача товаров.
*   Автоподнятие лотов.
*   Автоответ на заготовленные команды.
*   Автовосстановление лотов после продажи.
*   Автодеактивация лотов, если товары закончились.
*   Вечный онлайн.
*   Уведомления в телеграм.
*   Полноценная ПУ в Telegram.

### :left_speech_bubble: Уведомления и ПУ в Telegram

*   Возможность установки нескольких чатов для уведомлений.
*   Уведомления о поднятии лотов.
*   Уведомления о новых заказах.
*   Уведомления о выдаче товара.
*   Уведомления о новых сообщениях
*   Возможность отвечать на сообщения прямо из Telegram.
*   Возможность полностью настраивать автовыдачу / автоответчик и все остальные модули FPCortex.
*   Возможность добавлять автовыдачу для лотов, получая лоты прямо с FunPay.

### :gear: Дополнительные возможности

*   Использование переменных в тексте для автоответа / автовыдачи.
*   Создание плагинов для кастомизации функционала без редактирования исходного кода самого Кортекса.

## :1st_place_medal: Преимущества
### :grinning: Для пользователей

*   Больше, чем наличие самого нужного функционала.
*   Оптимизация. 20 МБ свободного места на диске, до 50 МБ ОЗУ, доступ в интернет - все что нужно для работы.
*   Возможность установить на любую платформу, которую поддерживает Python: Windows, Linux, IOS, Android и т.д.
*   Возможность установки плагинов дает огромную вариативность модификации стандартного функционала под самые разные нужды.
*   Гибкие и при этом простые конфиги, написанные в INI-формате.
*   (Зависит от тебя) Постоянные обновления, быстрое реагирования на баги / предложения о новом функционале.
*   Полное управление через Telegram.

### :computer: Для разработчиков

*   Выбран самый простой и при этом один из самых мощных языков для такого рода приложений - Python.
*   Полная документация кода. Все классы / методы / функции имеют док-строки, type-хинты.
*   Широкое использование ООП. Почти каждый эвент / сообщение / заказ и т.д. представляют собой экземпляр соответствующего класса, а не просто набор данных в JSON.
*   Возможность легкого создания плагинов.
*   Сконфигурированный логгер. Никаких принтов!
*   Собственный Python-пакет [FunPayAPI], который никак не привязан к FunPay Cortex.
*   Поддержка лично от меня ([@beedge](https://github.com/beedgee)) :)

## :electric_plug: Плагины

*   [Канал с плагинами](https://t.me/FunPayCortex)
*   Управление плагинами доступно через Telegram ПУ.

## :arrow_down: Установка
### :large_blue_diamond: Windows

1.  Скачайте и установите Python 3.11.0.
2.  При установке поставьте галочку у `Add python.exe to PATH` на первом экране установки.
3.  Скачайте архив с кодом FunPay Cortex с GitHub (или другого источника).
4.  Распакуйте архив и перенесите папку `FunPayCortex-main` (или как она называется) в нужное Вам место.
5.  Перейдите в папку `FunPayCortex-main`.
6.  Запустите файл `Setup.bat` (если он есть, или установите зависимости вручную: `pip install -r requirements.txt`). Дождитесь окончания загрузки пакетов.
7.  Закройте командную строку и запустите файл `Start.bat` (или запустите вручную: `python main.py`).

### :hotsprings: Linux (Ubuntu)

1.  Обновите систему и установите необходимые пакеты:
    ```bash
    sudo apt update && sudo apt upgrade -y && sudo apt install python3 python3-pip python3-venv git wget -y
    ```
2.  Создайте пользователя (если необходимо) и переключитесь на него:
    ```bash
    sudo adduser cortexuser # (замените cortexuser на желаемое имя)
    su - cortexuser
    ```
3.  Клонируйте репозиторий (замените URL на свой, если он есть):
    ```bash
    git clone https://github.com/Beedgee/FunPayCortex.git FunPayCortex
    cd FunPayCortex
    ```
4.  Создайте виртуальное окружение и активируйте его:
    ```bash
    python3 -m venv pyvenv
    source pyvenv/bin/activate
    ```
5.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
6.  Запустите первоначальную настройку (если файл `configs/_main.cfg` отсутствует):
    ```python
    python main.py # (пройдите шаги настройки)
    ```
7.  (Опционально) Настройте запуск как сервис systemd (см. файл `FunPayCortex@.service`).

**Решение проблемы с кодировкой latin-1**

Если вы сталкиваетесь с ошибками, связанными с кодировкой latin-1, выполните следующие шаги:

1.  Выполните команду:
    ```bash
    sudo locale-gen ru_RU.UTF-8 # (или другую нужную локаль)
    ```
2.  Выполните команду:
    ```bash
    sudo update-locale LANG=ru_RU.UTF-8
    ```
3.  Перезайдите на сервер (выйдите и снова подключитесь).
4.  Попробуйте запустить бота снова.

### :iphone: Android (Termux)

Эта инструкция поможет вам установить и запустить FunPayCortex на вашем Android-устройстве с помощью Termux.

**Требования:**

*   Установленное приложение Termux из F-Droid (рекомендуется) или Google Play.
*   Стабильное интернет-соединение.
*   Достаточно свободного места на устройстве и оперативной памяти.
*   Зарядное устройство (процесс установки может быть энергозатратным).

⚙️ **Шаг 1: Подготовка Termux**

1.  Обновите пакеты Termux:
    Откройте Termux и выполните:
    ```bash
    pkg update -y && pkg upgrade -y
    ```
2.  Установите основные инструменты:
    ```bash
    pkg install python python-pip git -y
    ```
3.  Установите зависимости для сборки Python-пакетов:
    Некоторые Python-библиотеки требуют компиляции из исходного кода.
    ```bash
    pkg install build-essential clang libxml2 libxslt libjpeg-turbo libpng libcrypt pkg-config rust zlib libiconv -y
    ```
    *Примечание: Пакет `python-dev` (как в Debian/Ubuntu) в Termux не нужен или его функциональность покрывается другими пакетами. Если вы встретили ошибку `Package 'python-dev' has no installation candidate`, просто исключите его из команды.*

    `rust` необходим для сборки библиотеки `bcrypt`.

📥 **Шаг 2: Клонирование репозитория**

1.  Перейдите в желаемую директорию (например, в домашнюю `~`).
2.  Клонируйте репозиторий FunPayCortex:
    ```bash
    git clone https://github.com/Beedgee/FunPayCortex.git
    cd FunPayCortex
    ```

🐍 **Шаг 3: Настройка Python-окружения и установка зависимостей**

1.  Создайте и активируйте виртуальное окружение (настоятельно рекомендуется для изоляции зависимостей):
    ```bash
    python -m venv venv
    source venv/bin/activate
    ```
    После активации перед вашей командной строкой появится `(venv)`.
2.  Установите Python-зависимости:
    ```bash
    pip install -r requirements.txt
    ```
    ⚠️ **Важно при установке lxml:**
    На этапе:
    ```
    Building wheel for lxml (pyproject.toml) ... |
    ```
    Процесс может зависнуть на 10-30 минут (или даже дольше на слабых устройствах). Это нормально, `lxml` компилируется из исходного кода. Наберитесь терпения и не прерывайте процесс! Убедитесь, что экран не гаснет и Termux активен.

    Если `lxml` все равно не устанавливается после долгого ожидания:
    Прервите (Ctrl+c) и попробуйте установить `lxml` отдельно, указав пути к библиотекам:
    ```bash
    LDFLAGS="-L${PREFIX}/lib/" CFLAGS="-I${PREFIX}/include/" pip install lxml
    ```
    Затем снова запустите `pip install -r requirements.txt`.

    Если возникла ошибка `This package requires Rust >=1.64.0` для `bcrypt`:
    Это означает, что `rust` не был установлен или установлен некорректно. Убедитесь, что вы выполнили команду `pkg install rust -y` из Шага 1.3. После установки `rust` снова запустите `pip install -r requirements.txt`.

🚀 **Шаг 4: Первичная настройка и запуск**

1.  Запустите скрипт первичной настройки (если файл `configs/_main.cfg` отсутствует, бот сделает это автоматически):
    ```python
    python main.py
    ```
    Вам будет предложено ввести:
    *   `golden_key` вашего FunPay аккаунта.
    *   User-agent (можно оставить по умолчанию).
    *   API-токен вашего Telegram-бота (от @BotFather, имя бота должно начинаться с `funpay`).
    *   Пароль для доступа к Telegram-ПУ.
    *   Данные прокси (можно пропустить).
2.  Последующие запуски бота:
    Убедитесь, что вы находитесь в директории `FunPayCortex` и виртуальное окружение `venv` активировано.
    ```python
    python main.py
    ```

🌙 **Шаг 5: Обеспечение фоновой работы**

Чтобы бот продолжал работать после закрытия Termux или выключения экрана:

1.  Установите `tmux`:
    ```bash
    pkg install tmux -y
    ```
2.  Создайте новую сессию `tmux`:
    ```bash
    tmux new-session -s funpaycortex
    ```
3.  Внутри сессии `tmux`:
    *   Перейдите в директорию бота: `cd ~/FunPayCortex`
    *   Активируйте виртуальное окружение: `source venv/bin/activate`
    *   Запустите бота: `python main.py`
4.  Отсоединитесь от сессии: Нажмите `Ctrl+b`, затем `d`. Бот продолжит работать в фоне.
5.  Чтобы вернуться в сессию:
    ```bash
    tmux attach-session -t funpaycortex
    ```
6.  Для остановки бота: Находясь в сессии, нажмите `Ctrl+c`.
7.  Для "убийства" сессии `tmux` (и остановки бота, если он еще работает):
    ```bash
    tmux kill-session -t funpaycortex
    ```
Также рекомендуется использовать команду `termux-wake-lock` перед запуском бота в `tmux`, чтобы попытаться предотвратить "засыпание" устройства и Termux.

## :electric_plug: Установка плагинов

Не устанавливайте плагины из непроверенных источников. Через систему плагинов злоумышленники могут получить полный доступ к Вашему устройству или аккаунту FunPay. Установка плагинов крайне проста.

1.  Введите команду `/menu` в диалоге с ботом Telegram.
2.  Нажмите кнопку ▶️ `Далее`.
3.  Нажмите кнопку 🧩 `Плагины`.
4.  Нажмите кнопку ➕ `Добавить плагин`.
5.  Отправьте или перешлите боту файл плагина (`.py`).

## :question: Мне нужна помощь

<!-- Опционально: Добавьте свою контактную информацию/ссылку на поддержку -->
Если у вас остались какие-либо вопросы, обращайтесь к [@beedge](https://github.com/beedgee) или [в наш Telegram чат](https://t.me/FunPayCortex).

## :star: Star it

<!-- Опционально: Добавьте ссылку на ваш репозиторий -->
Если вам удобно пользоваться FunPay Cortex, не забудьте поставить :star: звезду :star: [данному проекту](https://github.com/Beedgee/FunPayCortex) в правом
верхнем углу GitHub-страницы (нужно быть авторизованным в свой аккаунт) :)
